[
["the-messy-salary-data.html", "Chapter 10 The messy salary data 10.1 Read in and clean data 10.2 Information about the variables 10.3 Analysis of gross income 10.4 Analysis of gross income type 10.5 LM and ANOVA analysis 10.6 Conclusion", " Chapter 10 The messy salary data This original salary data set is taken from the Payroll Data from online “https://data.ct.gov/Government/State-Employee-Payroll-Data-Calendar-Year-2015-thr/virr-yb6n/data”, Which includes the pay information from Calendar Year 2015 to the most recent pay period for Connecticut state employees. We take the subset only for 2017 fiscal year, which includes more than 1.77 million observations, 38 variables and 102,101 employees. For convenience, we randomly took 8500 employees from this subset as our focused data set (“state_empoyee_salary_data_2017.csv”). We are interested in those full time employees who got 26 pay checks in 2017 fiscal year. The relationships between income with other variables like age, sex, ethnic, union and so on are analyzed. First let’s clean our sampled data set. 10.1 Read in and clean data row0 is the subset only for 2017 fiscal year, seperated from the original whole dataset and saved as .csv file previously. Here we only show how we get the subset “raw” of sampled 8500 employee which can be found in our dataset file. raw0 &lt;- read.csv(&quot;datasets/State_Employee_Payroll_Data_Calendar_Year_2017.csv&quot;) employID &lt;- unique(raw0$EmplId.Empl.Rcd) sample &lt;- sample(employID, 8500) #randomly take 8500 employees raw &lt;- raw0[raw0$EmplId.Empl.Rcd %in% sample, ] %&gt;% droplevels() #get focuse data set str(raw) write.csv(raw, file = &quot;datasets/state_employee_salary_data_2017.csv&quot;, row.names = FALSE) From the sampled data set, We will pick full time employees as our goal and focus on the interested variables. Please pay attention to the different read-in methods between “read.csv” and “read_csv”. “read.csv()” define the variables as factor or numeric smartly, and categorize NA or empty space as one level independently; While “read_csv()” may need define class by yourself, treat missing value as “NA”, and will NOT count the missing value as one level. Here for our analysis, we will rename the missing “Ethric.Grp” as “unknown” later, so it’s necessary to read in the data using “read.csv()”! library(dplyr) raw &lt;- read.csv(&quot;datasets/state_employee_salary_data_2017.csv&quot;) raw1 &lt;- filter(raw, Full.Part == &quot;F&quot;) # pick full time employee raw2 &lt;- raw1[, -c(1:2, 5:9, 11:12, 19:23, 31:33, 35:36)] # keep only the interested variables We remove the variables we are not interested in. Now we will check the situation of employees. EmplId.Empl.Rcd &lt;- as.character(raw2$EmplId.Empl.Rcd) counts &lt;- data.frame(table(EmplId.Empl.Rcd)) PersonOccurCount &lt;- table(counts[, 2]) plot(PersonOccurCount, col = rainbow(30), xlab = &quot;Occurance of employee&quot;, ylab = &quot;Count of employee&quot;) Figure 10.1: Situation of check occurance of employees. The most employee-occurrence is 26. We will focus on the employees who have 26 paychecks for whole year in 2017. subEmpl26 &lt;- counts[which(counts$Freq != 26), ] len &lt;- length(subEmpl26$EmplId.Empl.Rcd) for(i in 1:len){ j &lt;- which(raw2$EmplId.Empl.Rcd == as.character(subEmpl26$EmplId.Empl.Rcd)[i]) if(i == 1) id = j else if(i &gt; 1) id = c(id, j) } raw26 &lt;- raw2[-id, ] # remove employees with check count not equal 26 We removed employees with check-count unequal to 26. Check.Dt &lt;- gsub(&quot; 12:00:00 AM&quot;, &quot;&quot;, raw26$Check.Dt) counts &lt;- table(Check.Dt) barplot(counts, col = rainbow(26), axis.lty = 1, xlab = &quot;Check Date&quot;, ylab = &quot;Count&quot;) Figure 10.2: The counts of checks for check date in 2017. The counts of checks for bi week almost the same, which means the employees kept same all the time in 2017 except 03/08/2017. We will remove the employee in this check date. empl38 &lt;- raw26[which(raw26$Check.Dt == &quot;03/08/2017 12:00:00 AM&quot;), ] raw26 &lt;- raw26[-which(raw26$EmplId.Empl.Rcd == empl38$EmplId.Empl.Rcd), ] Now we check the situation whether different genders are indexed for same employee. df &lt;- raw26 %&gt;% group_by(EmplId.Empl.Rcd, Sex) %&gt;% summarise(Total.Gross = sum(Tot.Gross )) dupliSex &lt;- df[duplicated(df$EmplId.Empl.Rcd), ] #Data frame for sex duplication obs. nrow(dupliSex) #row count for data frame ## [1] 0 With zero row of sex duplication observation, we conclude that there is no employee having different sex recorded. We will check whether sex “U” employee is still in our data nrow(raw26[which(raw26$Sex == &quot;U&quot;), ]) ## [1] 0 There is no sex “U” employees among those who got 26 pay check in 2017 ficial year, it’s already removed. Then we will check about the duplication situation of ethnic group. df &lt;- raw26 %&gt;% group_by(EmplId.Empl.Rcd, Ethnic.Grp) %&gt;% summarise(Total.Gross = sum(Tot.Gross )) dupliEthnic.Grp &lt;- df[duplicated(df$EmplId.Empl.Rcd), ] #Data frame for Ethnic duplication obs. nrow(dupliEthnic.Grp) #row count for data frame ## [1] 0 Zero row of Ethnic duplication observation tells us that there is no different ethnic recorded for the same employee. Now we notice that some employees even have gross income or biweekly rate less then zero. We consider to remove those employees. salary &lt;- raw26 subGross0 &lt;- salary[which(salary$Tot.Gross &lt;= 0 | salary$Bi.Weekly.Comp.Rate &lt;= 0), ] len &lt;- length(unique(subGross0$EmplId.Empl.Rcd)) for(i in 1:len){ j &lt;- which(salary$EmplId.Empl.Rcd == unique(subGross0$EmplId.Empl.Rcd)[i]) if(i == 1) id = j else if(i &gt; 1) id = c(id, j) } salary &lt;- salary[-id, ] #remove employees with negative or zero Tot.Gross and Bi.Weekly.Comp.Rate The employees with negative or zero Tot.Gross and biweekly rate are removed. Now let’s check the distribution of total gross. plot(salary$Tot.Gross, ylab = &quot;Total gross income&quot;) Figure 10.3: Scatterplot of total gross income. Most total gross point scatter under $20000, some of them are even above $60000. We will not keep those employees with Job.Indicator as “S” too. subIndicator &lt;- salary[which(salary$Job.Indicator == &quot;S&quot;), ] len &lt;- length(unique(subIndicator$EmplId.Empl.Rcd)) for(i in 1:len){ j &lt;- which(salary$EmplId.Empl.Rcd == unique(subIndicator$EmplId.Empl.Rcd)[i]) if(i == 1) id = j else if(i &gt; 1) id = c(id, j) } salary &lt;- salary[-id, ] #remove employees with Job indicator as &quot;S&quot; Employees with Job indicator as “S” are moved. We also will not consider those employees with duplicated union descriptions. df &lt;- salary %&gt;% group_by(EmplId.Empl.Rcd, Union.Descr) %&gt;% summarise(Total.Gross = sum(Tot.Gross )) dupliUnion &lt;- df[duplicated(df$EmplId.Empl.Rcd), ] len &lt;- length(dupliUnion$EmplId.Empl.Rcd) for(i in 1:len){ j &lt;- which(salary$EmplId.Empl.Rcd == dupliUnion$EmplId.Empl.Rcd[i]) if(i == 1) id = j else if(i &gt; 1) id = c(id, j) } salary &lt;- salary[-id, ] # remove employees with different Union descreption Finally, we cleaned our data according to our interest and we will group our left observations according to employee ID “EmplId.Empl.Rcd”, and just select variables like sex, ethnic group, union description, age, total gross and biweekly rate. We take round for age of each employee. salary &lt;- salary %&gt;% group_by(EmplId.Empl.Rcd, Sex, Ethnic.Grp, Union.Descr) %&gt;% summarise(Age = round(mean(Age), 0), Tot.Gross = mean(Tot.Gross), Bi.Weekly.Rate = mean(Bi.Weekly.Comp.Rate)) %&gt;% group_by(EmplId.Empl.Rcd) %&gt;% filter(n() == 1) %&gt;% droplevels() str(data.frame(salary)) ## &#39;data.frame&#39;: 3441 obs. of 7 variables: ## $ EmplId.Empl.Rcd: Factor w/ 3441 levels &quot;00034CF9004E4E0D7872FEB52CB5933F&quot;,..: 1 2 3 4 5 6 7 8 9 10 ... ## $ Sex : Factor w/ 2 levels &quot;F&quot;,&quot;M&quot;: 1 1 2 1 1 2 2 1 1 2 ... ## $ Ethnic.Grp : Factor w/ 8 levels &quot;&quot;,&quot;AMIND&quot;,&quot;ASIAN&quot;,..: 8 8 8 8 8 8 6 5 8 8 ... ## $ Union.Descr : Factor w/ 54 levels &quot;Admin and Residual (P-5)&quot;,..: 9 2 7 24 24 43 35 41 37 44 ... ## $ Age : num 73 64 65 54 50 46 71 47 52 48 ... ## $ Tot.Gross : num 4176 1799 1935 2751 2195 ... ## $ Bi.Weekly.Rate : num 3995 1776 1931 2713 2195 ... There is one level marked as “” in ethnic group, which means unknown for us. levels(salary$Ethnic.Grp)[levels(salary$Ethnic.Grp) == &quot;&quot;] &lt;- &quot;unknown&quot; We replace level of empty space in Ethnic.Grp as “unknown”. str(data.frame(salary)) ## &#39;data.frame&#39;: 3441 obs. of 7 variables: ## $ EmplId.Empl.Rcd: Factor w/ 3441 levels &quot;00034CF9004E4E0D7872FEB52CB5933F&quot;,..: 1 2 3 4 5 6 7 8 9 10 ... ## $ Sex : Factor w/ 2 levels &quot;F&quot;,&quot;M&quot;: 1 1 2 1 1 2 2 1 1 2 ... ## $ Ethnic.Grp : Factor w/ 8 levels &quot;unknown&quot;,&quot;AMIND&quot;,..: 8 8 8 8 8 8 6 5 8 8 ... ## $ Union.Descr : Factor w/ 54 levels &quot;Admin and Residual (P-5)&quot;,..: 9 2 7 24 24 43 35 41 37 44 ... ## $ Age : num 73 64 65 54 50 46 71 47 52 48 ... ## $ Tot.Gross : num 4176 1799 1935 2751 2195 ... ## $ Bi.Weekly.Rate : num 3995 1776 1931 2713 2195 ... summary(salary) ## EmplId.Empl.Rcd Sex Ethnic.Grp ## 00034CF9004E4E0D7872FEB52CB5933F: 1 F:1804 WHITE :2101 ## 001D621CF1C85C8F46EFD935CD685BFD: 1 M:1637 BLACK : 485 ## 004C3FFCCFC10A09D65CA3DF60CB69FD: 1 HISPA : 283 ## 0059143835BC7A37482ABF4B933A4642: 1 NSPEC : 236 ## 0059CD55728E16BC6BCFD35EDBA9DA32: 1 unknown: 211 ## 007CE08D82395FFD546943D382911009: 1 ASIAN : 109 ## (Other) :3435 (Other): 16 ## Union.Descr Age Tot.Gross ## Service/Maintenance (NP-2) : 299 Min. :22.00 Min. : 568.7 ## Correctional Officers (NP-4) : 289 1st Qu.:40.00 1st Qu.: 2414.2 ## Social and Human Services(P-2): 263 Median :49.00 Median : 3041.0 ## Administrative Clerical (NP-3): 252 Mean :47.71 Mean : 3222.5 ## Admin and Residual (P-5) : 214 3rd Qu.:56.00 3rd Qu.: 3754.7 ## Health Professional (P-1) : 198 Max. :81.00 Max. :17530.3 ## (Other) :1926 ## Bi.Weekly.Rate ## Min. : 25.78 ## 1st Qu.: 2145.94 ## Median : 2656.14 ## Mean : 2894.14 ## 3rd Qu.: 3443.95 ## Max. :12884.62 ## Now 3441 employees are included in our data set. These employees include both male and female, aged from 22 to 81, group into 8 different ethnics. They belong to 54 different Unions. The minimum total gross is $568.7 and maximum is $17530.3. Biweekly rate range is from $25.78 to $12884.62. As for this salary data, we will focus on the total gross income of these state employees. We are interested in the points such as: How about the distribution of the total gross income? Are male and female paid equally? Is there any difference in total gross for different age and age group? Do some ethnic group get better pay than the others? What’s the most important factor effecting the gross income of these state employees? First , let’s see the information of these variables. 10.2 Information about the variables 10.2.1 Income and age From previous plots of total gross, we know that “Tot.Gross” is not scattered randomly. We need to transform total gross first. salary$Gross.Log &lt;- log(salary$Tot.Gross) variable &lt;- c(&quot;Tot.Gross&quot;, &quot;Gross.Log&quot;, &quot;Age&quot;) # pick up the numeric columns par(mfrow = c(3, 2)) # layout in 3 rows and 3 columns for (i in 1:length(variable)){ sub &lt;- unlist(salary[variable[i]]) submean &lt;- mean(sub) hist(sub, main = paste(&quot;Hist. of&quot;, variable[i], sep = &quot; &quot;), xlab = variable[i]) abline(v = submean, col = &quot;blue&quot;, lwd = 1) qqnorm(sub, main = paste(&quot;Q-Q Plot of&quot;, variable[i], sep = &quot; &quot;)) qqline(sub) if (i == 1) {s.t &lt;- shapiro.test(sub) } else {s.t &lt;- rbind(s.t, shapiro.test(sub)) } } Figure 10.4: Histogram and QQ plot for total gross, log of gross and age. s.t &lt;- s.t[, 1:2] # take first two columns of shapiro.test result s.t &lt;- cbind(variable, s.t) # add variable name for the result s.t ## variable statistic p.value ## s.t &quot;Tot.Gross&quot; 0.840075 2.490722e-50 ## &quot;Gross.Log&quot; 0.9888379 7.88885e-16 ## &quot;Age&quot; 0.9848966 1.023745e-18 Tot gross is not statistically normally distributed. It’s extremely left skewed distributed. The distribution of Gross.Log, transformation of Tot.Gross is closer to normality than Tot.Gross. Highest frequency employees are aged between 45 and 50 years old. The distribution of age is close to bell shape. Shapiro tests deny the normality of all these three numeric variables. 10.2.2 Ethnic group library(ggplot2) counts &lt;- data.frame(sort(table(salary$Ethnic.Grp), decreasing = TRUE)) perc &lt;- paste(round(counts$Freq/sum(counts$Freq), 2)*100, &quot;%&quot;, sep = &quot;&quot;) ggplot(counts, aes(x = reorder(Var1, Freq), y = Freq)) + geom_bar(stat = &#39;identity&#39;, fill = rainbow(8)) + geom_text(aes(x = c(8:1), y = Freq + 100 , label = perc), size = 3.5) + labs(x = &#39;Ethnic Group&#39;, y = &#39;Freqency&#39;, title = &#39;Ethnic group by count&#39;) + theme_bw() + # classic dark-on-light coord_flip() + # flip the plot theme(plot.title = element_text(hjust = 0.5)) 61% of state employees are white, 14% are black. AMIND and PACIF are very limited. 10.2.3 Sex library(plotrix) counts &lt;- sort(table(salary$Sex), decreasing = TRUE) #labels with count number and percentage p &lt;- paste(round(counts/sum(counts), 2)*100, &quot;%&quot;, sep = &quot;&quot;) lbls &lt;- paste(names(counts), &quot;\\n&quot;, counts, p, sep = &quot; &quot;) pie3D(counts, labels = lbls, explode = 0.05, main = &quot;Pie chart of sex&quot;, labelcex = 1.0, labelpos=c(1.8, 5.0)) There are around 4% more female than male in the state employees. 10.2.4 Union descreption top10Union &lt;- data.frame(sort(table(salary$Union.Descr), decreasing = TRUE)[1:10]) #by count names(top10Union)[1] &lt;- &quot;Union.Descr&quot; topUnion &lt;- salary %&gt;% group_by(Union.Descr) %&gt;% summarise(Avg.Gross.Log = round(mean(Gross.Log), 3)) %&gt;% arrange(desc(Avg.Gross.Log)) %&gt;% head(10) #by average gross sales df &lt;- data.frame(top10Union, topUnion) names(df)[1]&lt;- &quot;Top unions by count&quot; names(df)[3]&lt;- &quot;Top unions by log of gross&quot; library(knitr) kable(df, booktabs=TRUE, caption = &quot;Top unions by count and average log value of gross&quot;) Table 10.1: Top unions by count and average log value of gross Top unions by count Freq Top unions by log of gross Avg.Gross.Log Service/Maintenance (NP-2) 299 UCHC - Faculty - AAUP 8.927 Correctional Officers (NP-4) 289 UCHC - Faculty 8.710 Social and Human Services(P-2) 263 Comm College Mgmt Exclusions 8.693 Administrative Clerical (NP-3) 252 UConn - Law School Faculty 8.605 Admin and Residual (P-5) 214 Amercan Fed of School Admin 8.523 Health Professional (P-1) 198 Connecticut Innovations Inc 8.511 Health NonProfessional (NP-6) 189 Exempt/Elected/Appointed 8.510 Engineer Scien Tech (P-4) 181 StatePoliceLts&amp;Captains (NP-9) 8.473 UCHC Univ Hlth Professionals 121 Managerial 8.416 Managerial 119 Crim Justice Managerial Exempt 8.389 The top unions by count are Service Maintain, Correctional officers, and Social &amp; Human Services. But according to average gross, the first four are all come from university or college. Except Managerial, the top unions by count are totally different from top unions by average gross. 10.3 Analysis of gross income 10.3.1 Age salary %&gt;% group_by(Age) %&gt;% summarise(Avg.Gross = mean(Tot.Gross)) %&gt;% ggplot(aes(x = Age, y = Avg.Gross)) + geom_bar(stat = &#39;identity&#39;, col = &quot;lightblue&quot;, fill=&quot;blue&quot;) + scale_x_continuous(breaks = seq(20, 90, 10)) + labs(y = &quot;Average gross income&quot;) Figure 10.5: Average gross and log of gross distribution by age. In total, the older the employees, the higher their gross income. Now we separate age into groups with age gap of 10. salary$Age. &lt;- cut(salary$Age, breaks = c(10, 20, 30, 40, 50, 60, 70, 80, 90), right = FALSE) stat &lt;- salary %&gt;% group_by(Age.) %&gt;% summarise(Avg.Gross.Log = mean(Gross.Log)) ggplot() + geom_boxplot(data = salary, aes(x = Age., y = Gross.Log, fill = Age.)) + geom_point(data = stat, aes(x = Age., y = Avg.Gross.Log), color = &quot;brown&quot;) + geom_text(data = stat, aes(label = round(Avg.Gross.Log, 2), x = Age., y = Avg.Gross.Log - 0.1)) Figure 10.6: Distribution of log of gross by age group. With average 10 years of age increasing, log value of gross increase step by step until age 80. model &lt;- aov(salary$Gross.Log~salary$Age.) summary(model) ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## salary$Age. 6 33.0 5.500 54.53 &lt;2e-16 *** ## Residuals 3434 346.4 0.101 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 With p value of much less than 0.05, we reject the null hypothesis that there is no significant difference among these means of log value of gross income for different age groups, which means there is at least one of the means of log value of gross income is different from the others. library(agricolae) # LSD.test need provide degrees of freedom and mean square for errors. We can got it from aov. res &lt;- LSD.test(salary$Gross.Log, salary$Age., DFerror = model$df.residual, MSerror=anova(model)[[&quot;Mean Sq&quot;]][2]) res$groups ## salary$Gross.Log groups ## [70,80) 8.284744 a ## [60,70) 8.122599 b ## [50,60) 8.068892 c ## [40,50) 8.032668 d ## [30,40) 7.913289 e ## [20,30) 7.756642 f ## [80,90) 6.343428 g From the information of pairwise comparison, the total different alpha beta index indicates that these 8 age groups are significantly different from each other in mean log value of total gross income. The elder the age, the higher the log value of gross income, except for age group between 80 and 90, which has the lowest mean log gross income comparing with all other age groups. library(scales) library(plotly) p &lt;- salary %&gt;% group_by(Union.Descr, Age) %&gt;% summarise(Avg.Gross = mean(Gross.Log)) %&gt;% arrange(desc(Avg.Gross)) %&gt;% ggplot(aes(x = Age, y = Avg.Gross, fill = Union.Descr)) + geom_bar(stat = &quot;identity&quot;, position = &quot;fill&quot;) + scale_y_continuous(labels = percent_format()) + scale_x_continuous(breaks = seq(10, 100, 10)) + labs(y = &quot;Percentage&quot;) + theme(panel.background = element_rect(fill = &quot;black&quot;), panel.grid.major = element_blank(), panel.grid.minor=element_blank()) ggplotly(p) Figure 10.7: Percentage of union descriptions by age group. This is the distribution of average gross percentage of Union Descriptions by age group. By use mouse we can find out the information of percentage occupation of union description for certain age. For example, for age 22, Administrative Clerical, Exempt/Elected/Appointed, Service/Maintenance and UCHC Univ Hlth Professional these four union share the total Log of gross almost equally, while for age 81, the only union is Legislative Management. 10.3.2 Sex par(mfrow = c(1, 2)) # density plot for each sex df1 &lt;- salary[which(salary$Sex == &quot;F&quot;), ] df2 &lt;- salary[which(salary$Sex == &quot;M&quot;), ] plot(density(df1$Gross.Log), col = &quot;red&quot;, xlab = &quot;Log of Gross&quot;, main = &quot;Density plot for each sex&quot;) lines(density(df2$Gross.Log), col = &quot;blue&quot;) #add density line of df2 to density plot of df1 legend(&quot;topright&quot;, c(&quot;M&quot;,&quot;F&quot;), lty = c(1, 1), col = c(&quot;blue&quot;, &quot;red&quot;)) #add legend # LSD comparison for sex grouop model &lt;- aov(salary$Gross.Log~salary$Sex) res &lt;- LSD.test(salary$Gross.Log, salary$Sex, DFerror = model$df.residual, MSerror=anova(model)[[&quot;Mean Sq&quot;]][2]) gross &lt;- round(res$groups[, &quot;salary$Gross.Log&quot;], 2) plot(res, xlab = &quot;Sex Group&quot;, ylab = &quot;Range between max and min&quot;, main = &quot;Sex groups and variation range&quot;) text(x = c(seq(from = 1, to = 10, by = 1.2)), y = 8, gross) Figure 10.8: Log of gross comparison by sex group. Density plot shows blue male line is later than red female line, which means male has bigger log of gross than female in total. The density peak of female is earlier than male also tell the same story. The total different alpha beta index indicates that these 2 sex groups are significantly different from each other in mean log of gross, male get higher gross income than female. # p1 produce the point and line plot p1 &lt;- salary %&gt;% group_by(Ethnic.Grp, Sex) %&gt;% summarise(Avg.Gross = mean(Gross.Log)) %&gt;% ggplot(aes(x = Ethnic.Grp, y = Avg.Gross, colour = Sex, group = Sex)) + geom_line(size = 1) + geom_point(size = 4, shape = 19) + theme(axis.text.x = element_text(angle = 45, hjust = 1), panel.grid.major = element_blank(), legend.position = &quot;bottom&quot;) + labs(x = &quot;Ethnic Group&quot;, y = &quot;Average Gross Log&quot;) # p2 produce the density ridge plot library(ggridges) p2 &lt;- salary %&gt;% group_by(Ethnic.Grp, Sex) %&gt;% ggplot(aes(x = Gross.Log, y = Ethnic.Grp, fill = Sex)) + geom_density_ridges(alpha = 0.55) + theme(legend.position = &quot;bottom&quot;) + xlim(6.0, 10.0) # Lay out p1 and p2 in same row library(gridExtra) grid.arrange(p1, p2, nrow = 1) Figure 10.9: Log of gross comparison by ethnic and sex group. Both plots tell us that for other ethnic groups except Asian, male has higher average log gross than female. On average, Asian female earn similar as male. Amind male have more bigger log of gross than Amind female. From the left point-line plot we can see the same situation for Pacif ethnic. Because of the tiny amount of PACIF employees, there is no ridge showing in the right density-ridge plot. # Standardize Gross.Log first. Separate into two groups &quot;Below average&quot; and &quot;Above average&quot; Sd.Gross &lt;- round((salary$Gross.Log - mean(salary$Gross.Log))/sd(salary$Gross.Log), 2) Gross.Type &lt;- ifelse(Sd.Gross &lt; 0, &quot;Below average&quot;, &quot;Above average&quot;) Sex &lt;- salary$Sex Category &lt;- salary$Union.Descr df &lt;- data.frame(Category, Sd.Gross, Gross.Type, Sex) ggplot(df, aes(x = Category, y = Sd.Gross)) + geom_bar(stat = &#39;identity&#39;, aes(fill = Gross.Type), width = .5) + facet_wrap(~ Sex) + # arranges panels according to sex labs(x = &quot;Union Descreption&quot;, y = &quot;Standardized log of gross&quot;) + coord_flip() + # horizontal plot theme(legend.position = &quot;top&quot;) Figure 10.10: Diverging bars of stanardized log of gross income. From the figure we can see that for both male and female, the pattern of above and below average for almost all of the union description are similar. The only difference is the difference in total standardized log value of gross for male and female. For example, for union UCHC Univ Hlth Professionals on top, administrative Clerical on the bottom and other two unions like service/maintenance and Correctional Officers, all these four unions have more standardized log value of gross below average, which means these are relatively low pay unions. At the same time, female UCHC Univ Hlth Professionals, administrative Clerical and male service/maintenance and Correctional Officers get this log value less comparing with the other gender in the same union, which may be explained that more females work in Univ Hlth Professionals, administrative Clerical union, while more males work as service/maintenance and Correctional Officers. On the other hand, union Uconn Faculty, Engineer Scien Tech, Health professional and Judicial Professional have more standardized log value of gross above average, which means they are good pay union. Maybe there are less female Uconn Faculty and Engineer Scien Tech, and less male Health professional and Judicial Professional because these combinations get less positive log value than the other gender in the same union. 10.3.3 Ethnic Group # Bar plot with error bar for different ethnic group p1 &lt;- salary %&gt;% group_by(Ethnic.Grp) %&gt;% summarise(mean = mean(Gross.Log), sd = sd(Gross.Log), se = sd(Gross.Log)/sqrt(n())) %&gt;% ggplot(aes(x = Ethnic.Grp, y = mean, color = Ethnic.Grp, fill = Ethnic.Grp)) + geom_bar(stat = &quot;identity&quot;) + geom_errorbar(aes(ymin =mean - se, ymax =mean + se), color = &quot;black&quot;, width = 0.3) + theme(axis.text.x = element_text(angle = 45, hjust = 1)) # Density ridges for different ethnic group library(ggridges) p2 &lt;- salary %&gt;% group_by(Ethnic.Grp) %&gt;% ggplot(aes(x = Gross.Log, y = Ethnic.Grp, color = Ethnic.Grp, fill = Ethnic.Grp)) + geom_density_ridges(alpha = 0.5) + xlim(6.0, 10.0) + coord_flip() + theme(legend.position = &quot;none&quot;) # display two plots in same row grid.arrange(p1, p2, nrow = 1) Figure 10.11: Bar and density ridge plot of log of gross by ethnic. From the bar figure we can see that Asian and White have relatively high gross incomes, Pacif and unknown get lower gross incomes. There is no big difference of variance for all other ethnic groups but Pacif, next Amind. Density ridge plot shows White, Asian and Nespec have biggest density above log of gross of 8.5, while unknown, Amind and Hispa have more density below 8. Ethnic Black’s density keep even at both sides of log of gross of 8. At the same time, ethnic group of white, black, and unknown have relatively symmetrical density distribution; Asian and Nespec have upper skewed density; While AMIND and HISPA have lower skewed density. # get ethnic order according frequency of count CountEthnic &lt;- data.frame(sort(table(salary$Ethnic.Grp), decreasing = TRUE)) # get ethnic order according log of gross income GrossEthnic &lt;- salary %&gt;% group_by(Ethnic.Grp) %&gt;% summarise(Avg.Gross = mean(Gross.Log)) %&gt;% arrange(desc(Avg.Gross)) %&gt;% pull(Ethnic.Grp) # build data frame for rank of these two ethnic order EthnicGroup &lt;- unlist(list(CountEthnic[, 1], GrossEthnic)) Rank &lt;- rep(1:8, 2) EthnicType &lt;- rep(c(&quot;CountEthnic&quot;,&quot;GrossEthnic&quot;), each = 8) dat &lt;- data.frame(Rank, EthnicType, EthnicGroup) # point plot two set of ethnics according rank and connect same ethnic by line ggplot(dat, aes(y = Rank, x = EthnicType, label = EthnicGroup, group = EthnicGroup) )+ geom_line(size = 1) + geom_point(aes(color = EthnicGroup), size = 5) + scale_y_continuous(breaks = seq(0,10,1)) + annotate(&quot;text&quot;, x = 0.7, y = Rank[1:8], label = EthnicGroup[1:8], hjust = 0, cex = 3.5) + annotate(&quot;text&quot;, x = 2.1, y = Rank[9:16], label = EthnicGroup[9:16], hjust = 0, cex = 3.5) Figure 10.12: Ethnic rank plot by count and log of gross. According to count, most of the state employees are white and Black. Hispa and Nspec occupy the third and fourth in the list. By average log of gross, the first Ethnic group is Asian, then Nspec and White. Black is in 4th place by gross. Pacif keeps the last for both count and average log gross rank. model &lt;- aov(Gross.Log ~ Ethnic.Grp, data = salary) tukey &lt;- TukeyHSD(model) par(mar = c(4, 10, 2, 1)) psig = as.numeric(apply(tukey$Ethnic.Grp[, 2:3], 1, prod) &gt;= 0) + 1 plot(tukey, col = psig, las = 1, cex.axis = 0.7, yaxt = &quot;n&quot;) for (j in 1:length(psig)){ axis(2, at = j,labels = rownames(tukey$Ethnic.Grp)[length(psig) - j + 1], las = 1, cex.axis = .8, col.axis = psig[length(psig) - j + 1]) } There is no significant difference between the means of log gross for black pairs but for the red pairs in plot, such as unknown with Asian, Black, Nspec and White; Asian with Black, Hispa and White; Black with Hispa and White; Hispa with Nespa and White. ggplot(salary, aes(x = Age, y = Gross.Log, colour = Sex, shape = Sex)) + geom_point() + ggtitle(&quot;Scatterplot of log of gross vs Age by Sex and Ethnic&quot;) + facet_wrap(~ Ethnic.Grp) + # arrange panels by Ethnic Group geom_smooth(aes(colour = Sex), method = &#39;lm&#39;,formula = y ~ x) + # add the regression line theme(plot.title = element_text(hjust = 0.5), legend.position = c(0.85, 0.15)) In our data set, we have much more employees in white, but really little in Pacif. For both male and female, with increasing in age, log of gross increase slightly for all other ethnics but Nspec. For most ethnics, male and female have similar pattern for the relation between age and log of gross. For ethnic unknown and Amind, male’s log of gross increase faster than female, but for Asian, male’s log of gross increase slower than female. 10.4 Analysis of gross income type 10.4.1 Gross Type According to the average log of gross for each employee, we separate the employees into three groups: High.Gross with average log of gross greater than 8.5, Middle.Gross with average log of gross greater than 7.8, and Low.Gross with average log of gross equal or less than 7.8. #regroup gross by average log of gross for each EmplId.Empl.Rcd as Gross.Type High.Gross &lt;- as.vector(salary$EmplId.Empl.Rcd[which(salary$Gross.Log &gt; 8.5)]) Middle.Gross &lt;- as.vector(salary$EmplId.Empl.Rcd[which(salary$Gross.Log &gt; 7.8)]) salary &lt;- salary %&gt;% mutate(Gross.Type = ifelse(EmplId.Empl.Rcd %in% High.Gross, &quot;High&quot;, ifelse(EmplId.Empl.Rcd %in% Middle.Gross, &quot;Middle&quot;, &quot;Low&quot;))) For each gross type, we try to get information about total number of observation, percentage, employee number, average log of gross, average of total gross and standardized total gross. library(janitor) df1 &lt;- salary %&gt;% group_by(Gross.Type) %&gt;% tabyl(Gross.Type) df2 &lt;- salary %&gt;% group_by(Gross.Type) %&gt;% summarise(Avg.Log.Gross = mean(Gross.Log), Avg.Tot.Gross = mean(Tot.Gross)) df &lt;- merge(df1, df2, by=&quot;Gross.Type&quot;) %&gt;% arrange(desc(Avg.Log.Gross)) df &lt;- round(df[, 2:5], 2) # round all numeric variables to decimal 2 Gross.Type = c(&quot;High, Gross.Log&gt;8.5&quot;, &quot;Middle, Gross.Log&gt;7.8&quot;,&quot;Low, Gross.Log&lt;=7.8&quot;) df &lt;- cbind(Gross.Type, df) kable(df, booktabs=TRUE, caption = &quot;Table of gross type&quot;) Table 10.2: Table of gross type Gross.Type n percent Avg.Log.Gross Avg.Tot.Gross High, Gross.Log&gt;8.5 217 0.06 8.72 6307.37 Middle, Gross.Log&gt;7.8 2329 0.68 8.11 3379.69 Low, Gross.Log&lt;=7.8 895 0.26 7.62 2065.61 df$Gross.Type &lt;- factor(df$Gross.Type, levels = df$Gross.Type) ggplot(df, aes(x = Gross.Type, label = paste(Avg.Tot.Gross, paste(percent*100, &quot;%&quot;, sep = &quot;&quot;), sep = &quot;, &quot;))) + geom_bar(aes(y = n), stat = &quot;identity&quot;, fill = rainbow(3)) + geom_line(aes(y = Avg.Log.Gross*250, group = 1, colour = &quot;Avg.Tot.Gross*250&quot;), size = 2) + geom_point(aes(y = Avg.Log.Gross*250, group = 1, colour = &quot;Avg.Tot.Gross*250&quot;), size = 4) + labs(x = &quot;Gross Type&quot;, y = &quot;Employee Number&quot;, title = &quot;Average gross and employee distribution for each gross type&quot;) + theme(plot.title = element_text(hjust = 0.5)) + geom_text(x= c(1, 2, 3), y = c(2000, 1900, 1800), size = 4, color = &quot;black&quot;) High gross group occupy 6% of the total employees. Around 68% employees earned middle gross, and around 26% employees earned low. The gross decrease straightly. The real average total gross change from 6307 dollars/Bi-weekly to 3380, then to 2066 for high, middle and low gross group. The average real gross income for high gross group is more than 3 times of that for low gross group. 10.4.2 Ethnic and Sex and age salary %&gt;% mutate(EthnicSex = paste(Ethnic.Grp, Sex, sep = &quot;-&quot;)) %&gt;% tabyl(EthnicSex, Gross.Type, show_missing_levels = FALSE) %&gt;% adorn_totals(&quot;row&quot;) %&gt;% adorn_totals(&quot;col&quot;) %&gt;% adorn_percentages(&quot;all&quot;) %&gt;% adorn_pct_formatting(digits = 1) %&gt;% adorn_ns %&gt;% adorn_title ## Gross.Type ## EthnicSex High Low Middle Total ## AMIND-F 0.0% (0) 0.1% (5) 0.1% (3) 0.2% (8) ## AMIND-M 0.0% (1) 0.0% (0) 0.1% (5) 0.2% (6) ## ASIAN-F 0.3% (10) 0.3% (11) 1.0% (36) 1.7% (57) ## ASIAN-M 0.2% (7) 0.2% (6) 1.1% (39) 1.5% (52) ## BLACK-F 0.3% (10) 2.5% (86) 5.8% (199) 8.6% (295) ## BLACK-M 0.3% (11) 1.2% (42) 4.0% (137) 5.5% (190) ## HISPA-F 0.1% (3) 1.7% (60) 2.8% (95) 4.6% (158) ## HISPA-M 0.1% (3) 1.4% (47) 2.2% (75) 3.6% (125) ## NSPEC-F 0.2% (7) 1.0% (33) 2.9% (101) 4.1% (141) ## NSPEC-M 0.2% (8) 0.8% (26) 1.8% (61) 2.8% (95) ## PACIF-F 0.0% (0) 0.0% (1) 0.0% (0) 0.0% (1) ## PACIF-M 0.0% (0) 0.0% (0) 0.0% (1) 0.0% (1) ## unknown-F 0.3% (10) 1.9% (64) 1.7% (57) 3.8% (131) ## unknown-M 0.2% (6) 1.2% (41) 1.0% (33) 2.3% (80) ## WHITE-F 1.1% (37) 7.6% (261) 20.8% (715) 29.4% (1013) ## WHITE-M 3.0% (104) 6.2% (212) 22.4% (772) 31.6% (1088) ## Total 6.3% (217) 26.0% (895) 67.7% (2329) 100.0% (3441) In high gross type, white male occupy much bigger portion than any other male or female ethnic groups. For other ethnic groups with high gross income, female’s portion is equal or higher than male. Situation keeps similar to high gross type for middle gross type, white and Asian male occupy more portion than white and Asian female, while for other ethnics, female is more than male. For low gross type, no matter the ethnic the employees belong, female is more than male. In total, only white male is more than female, but for all other ethnics, female is more than male. For all other ethnics, over half of the employees belong to middle gross type, but unknown group has more people in low gross type. library(ggmosaic) h_mosaic &lt;- ggplot(data = salary) + geom_mosaic(aes(x = product(Sex, Ethnic.Grp), fill = Age.), na.rm = T, divider = mosaic(&quot;h&quot;)) + theme(plot.title = element_text(hjust = 0.5), axis.text.x = element_text(angle = 90, size = 6), legend.position=&quot;top&quot;,legend.text=element_text(size = 6), panel.background = element_rect(fill=&quot;black&quot;), panel.grid.major = element_blank()) + labs(x = &quot;&quot;, y = &quot;&quot;, title= &quot;Mosaic Plot for Gross Group by Ethnic and Sex Group&quot;) + facet_grid(Gross.Type ~ .) ggplotly(h_mosaic, width = 750, height = 500) %&gt;% layout(legend = list(orientation = &quot;h&quot;, y = 1)) Here is the mosaic plot of each sub group we discussed in the above table of gross type and ethnic group. They are high, middle and low gross type from upper to lower. We add age group as another factor. There are much more elder employees above 50 appearing in high gross group, especially the male elders aged between 70 and 80. 10.5 LM and ANOVA analysis According to our previous analysis we try to fit a model for log of gross with Age., Ethnic.Grp, Sex, and Union description. salaryglm &lt;- salary[, -c(1, 6:7, 9:10)] # remove first col. of EmplId.Empl.Rcd model0 &lt;- lm(Gross.Log ~ ., data = salaryglm) ss &lt;- coef(summary(model0)) # take only coeficient of summary ss.sig &lt;- ss[ss[, &quot;Pr(&gt;|t|)&quot;] &lt; 0.05, ][1:20, ] # show first 20 coeficient with p&lt;0.05 ss.sig ## Estimate Std. Error ## (Intercept) 7.53153247 0.03449654 ## SexM 0.06950292 0.00926251 ## Ethnic.GrpAMIND 0.21998688 0.06774550 ## Ethnic.GrpASIAN 0.19194372 0.03354914 ## Ethnic.GrpBLACK 0.15780719 0.02657445 ## Ethnic.GrpHISPA 0.11448845 0.02776897 ## Ethnic.GrpNSPEC 0.13227360 0.02551390 ## Ethnic.GrpWHITE 0.14666022 0.02461445 ## Union.DescrAdministrative Clerical (NP-3) -0.39303463 0.02210547 ## Union.DescrAmercan Fed of School Admin 0.41117127 0.11893504 ## Union.DescrComm College Admin - CCCC -0.22235053 0.03617872 ## Union.DescrComm College Faculty CCCC -0.09661379 0.03681822 ## Union.DescrComm College Mgmt Exclusions 0.54115377 0.16743739 ## Union.DescrConfidential -0.16454268 0.04305299 ## Union.DescrConn Assoc Prosecutors 0.29935059 0.05673950 ## Union.DescrConnecticut Innovations Inc 0.55456110 0.09265495 ## Union.DescrCorrectional Officers (NP-4) -0.09952380 0.02206728 ## Union.DescrCorrectional Supervisor (NP-8) 0.16602156 0.04387205 ## Union.DescrCriminal Justice Residual -0.38863702 0.08485137 ## Union.DescrEducation A (P-3A) 0.21950893 0.06301334 ## t value Pr(&gt;|t|) ## (Intercept) 218.327176 0.000000e+00 ## SexM 7.503682 7.890072e-14 ## Ethnic.GrpAMIND 3.247255 1.176634e-03 ## Ethnic.GrpASIAN 5.721272 1.149428e-08 ## Ethnic.GrpBLACK 5.938305 3.171674e-09 ## Ethnic.GrpHISPA 4.122891 3.831477e-05 ## Ethnic.GrpNSPEC 5.184375 2.294737e-07 ## Ethnic.GrpWHITE 5.958298 2.810636e-09 ## Union.DescrAdministrative Clerical (NP-3) -17.779971 1.118520e-67 ## Union.DescrAmercan Fed of School Admin 3.457108 5.527464e-04 ## Union.DescrComm College Admin - CCCC -6.145893 8.878783e-10 ## Union.DescrComm College Faculty CCCC -2.624075 8.727566e-03 ## Union.DescrComm College Mgmt Exclusions 3.231977 1.241181e-03 ## Union.DescrConfidential -3.821864 1.348327e-04 ## Union.DescrConn Assoc Prosecutors 5.275877 1.404436e-07 ## Union.DescrConnecticut Innovations Inc 5.985229 2.386971e-09 ## Union.DescrCorrectional Officers (NP-4) -4.510017 6.702718e-06 ## Union.DescrCorrectional Supervisor (NP-8) 3.784222 1.568656e-04 ## Union.DescrCriminal Justice Residual -4.580209 4.812871e-06 ## Union.DescrEducation A (P-3A) 3.483531 5.011306e-04 # show Adjusted R-squared value statistic &lt;- paste(&quot;Adjusted R-squared&quot;,round(summary(model0)$adj.r.squared, 4), sep = &quot;: &quot;) statistic ## [1] &quot;Adjusted R-squared: 0.497&quot; model1 &lt;- aov(Gross.Log ~ ., data = salaryglm) summary(model1) ## Df Sum Sq Mean Sq F value Pr(&gt;F) ## Sex 1 4.83 4.833 87.14 &lt;2e-16 *** ## Ethnic.Grp 7 13.90 1.986 35.81 &lt;2e-16 *** ## Union.Descr 53 153.71 2.900 52.29 &lt;2e-16 *** ## Age 1 19.54 19.544 352.35 &lt;2e-16 *** ## Residuals 3378 187.37 0.055 ## --- ## Signif. codes: 0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1 LM model indicate that Average Gross is related with all factors including Age, Ethnic group, Sex, and Union description. ANOVA test illustrates Average Gross is significantly affected by all four factors, especially by age and sex. 10.6 Conclusion Total Gross is not statistically normally distributed. It skewed to left. After taking log transformation, it is more close to normality. The elder the age, the higher the gross income, but not for age group between 80 and 90. On average, males earn more than females in the same age, ethnic, union. The means of log gross are significantly different for different ethnic groups. On average, Asian and white are the top two groups. PACIF and unknown are the last. The real average total gross change from 6307 dollars bi-weekly to 3380, and to 2066 for high , middle and low gross group. High, middle and low gross group occupy 6%, 68%, and 26% of the total employees. White male occupy much bigger portion in high gross group, especially the elder white male. Age group, Union description, Sex, and Ethnic group together will explained 50% of log variance of gross. Exercise 10.1 Create a folder, download the data file “state_empoyee_salary_data_2017.csv” into it, and create an Rstudio project in the folder. Read in the data file, peak the structure of your data set and clean it step by step: Select only columns of “EmplId.Empl.Rcd”, “Bi.Weekly.Comp.Rate”, “Age”, “Ethnic.Grp”, “Sex”, “Full.Part”, “City”, get summary information for all these variables. Make sure “EmplId.Empl.Rcd”, “Sex”, “Ethnic.Grp” to be factor, “Age” and “Bi.Weekly.Comp.Rate” to be numeric. Pick up full time employees in city “Hartford”. Select only those employees with 26 pay checks for 2017 ficial year(Hint:Each employee has unique ID of “EmplId.Empl.Rcd”). Remove sex group other than “F” and “M” if there is any. Hint:Use str() after droplevels(). Replace level of empty space in “Ethnic.Grp” as “unknown”. Remove emplolyees with “Bi.Weekly.Comp.Rate” equal or less than zero if there is any. Group your data set by “EmplId.Empl.Rcd”, “Ethnic.Grp”, and “Sex”. For each employee, take the mean of “Age”, and the mean of “Bi.Weekly.Comp.Rate”. Then round the means to the nearest integer and rename them as “Age” and “Bi.Weekly.Rate”. Show structure and summary of your data set. Show the distribution of “Bi.Weekly.Rate” and “Age” using histogram and QQ plot. Test the normality. Transform by taking log value if it is necessary. Using pie plot to show the distribution of “Sex”. List the count number and percent of employees in each ethnic group. Using scatter plot to view the relationship between average “Bi.Weekly.Rate” and “Age”, add regression line and give your interpretation. Using box plot to view the relationship between “Bi.Weekly.Rate” by Ethnic groups. Using a density plot similar to Figure 10.8 to view the distribution of “Bi.Weekly.Rate” for different sex. Package ggplot2 is referred. Do ANOVA test to check whether male are the same as female in “Bi.Weekly.Rate” in city “Hartford”. Explore the interaction of “Ethnic.Grp” and “Sex” to “Bi.Weekly.Rate” using density ridges plot similar to Figure ?? and interpret your plot. "]
]
